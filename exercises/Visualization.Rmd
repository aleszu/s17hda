---
title: "Visualization"
author: "Ryan Cordell"
date: "2/6/2017"
output: html_document
---

Load 'em up:

```{r}
library(ggplot2)
library(tibble)
```

One of the primary reasons data analysts gravitate toward R is its capacity for creating visualizations. In today's lesson we cannot possibly cover all these possibilities—and we will leave one huge category of visualization, the map, for next week—but we will survey some of the most prevelant types of data visualization in humanistic scholarship. 

Graphs, charts, and other forms of data viz have become increasingly common in literary-historical research in the past decade, though humanists have not necessary developed sufficiently sophisticated frameworks for understanding their creation or their epistemological status. As we work through these practical exercises, then, we should discuss also what visualizations reveal and conceal about the data they represent, and consider the evidentiary functions they might serve. 

Okay, let's load some data. I figured out why our tibbles weren't loading correctly last week. Along with the new dataframe protocol, there's a new function for reading in tabular data, `read_csv` (with an underscore):

```{r}
census <- read_csv(file = "./data/1840-census-data.csv") %>%
  # select(1,90:107) %>%
  rename(county = QualifyingAreaName) %>%
  separate(county, into = c("county", "state"), sep = "\\, ")
```

Most of what we didn't get to last week—Fitz's exercises on text analysis—we are putting off for a few weeks. There's one important bit I didn't get to share, however, which is how to export the results of your transformations. As with importing data, there are many possibilities, but to export a CSV, you use the function `write.csv`, which is followed by at least two arguments: the data you wish to export and the destination of the file. I would recommend creating an `output` folder in your working directory for such files, so they don't get confused with your source data. To export that network data from last week, for instance, we could run the following (assuming that dataframe is still in your global enviornments). 

```{r}

write.csv(vtEdges, file="./output/vtEdges.csv")

```

Okay, on to visualization! 

## The philosophy of `ggplot`

Today we will work mostly with `ggplot2`—included in the `tidyverse`—which implements a "grammar of graphics"—hence "gg"—in the R environment. `ggplot2` uses a philosophy of chaining that should be familiar from your work with dplyr. While the order of the chain in `dplyr` is paramount, `ggplot` is a little more flexible. You have to create a plot using the `ggplot()` function: but then you can add elements to it in an order that's not always strictly proscribed. But in creating a plot, you'll certainly have to do each of the following (though sometimes just implicitly):

1. Select a data source
2. Choose a geometry, or plot type
3. Set an aesthetic mapping (more on this below)
4. Set your scales
5. Set your facets
6. Other things

We can't possibly survey every type of visualization you can create in R or all the nuances of refining those visualizations. Today we will introduce a few possibilities, and you should expect to see plenty of examples of such charts and visualization—including variations and nuances on them—as we move forward this semester.

## Histograms

Perhaps the most basic—though extrememly useful!—type of chart is the histogram, which shows the frequency of a single variable at different intervals. Those intervals could be temporal or based on another continuous scale in your data (e.g. age, height, length). Histograms resemble bar charts, which we will discuss next, but the histogram represents "continuous data" while the bar chart represents distinct categories. This should be more clear through example.  

To start, I'll show you a feature of our Viral Texts data that histograms helped me understand better than I did before plotting it. We'll load the same clusters we started to use last week. Note that we're using `read_csv` to import directly into a tibble. To see one difference, check the class of the `text` column after importing the Viral Texts data below.

```{r}

vtClusters <- read_csv(file="./data/VT-vignettes.csv") %>% 
  mutate(title = gsub('(.*)\\.*\\(.*','\\1',title)) %>%
  mutate(date = as.Date(date, "%Y-%m-%d"))

```

In the code below, we invoke `ggplot` and then add a histogram `layer` to it. We identify `date` as the continuous variable for the x axis of the plot.

```{r}

ggplot(vtClusters %>% filter(cluster == 321785)) + geom_histogram(aes(x=date))

```

The primary element we control when creating histograms is the size of the bins the data should be sorted into: these "bins" can be thought of as the intervals of the chart, and the bins you choose can have a dramatic effect both on what the charts look like *and* what they say about your data. For any given histogram, you should not be content with the default bin size but instead experiement with different possibilities. When your x axis is dates, the bins refer to numbers of days, meaning this revision of our histogram uses bins of 1 year:

```{r}

ggplot(vtClusters %>% filter(cluster == 321785)) + geom_histogram(aes(x=date), binwidth=365)

```

That looks quite a lot like our original plot, but what happens if you change the bidwidth to one month? Three years? Experiment a bit below.

```{r}



```

Note that some elements in the grammar of `ggplot` can be placed at different spots in the code, as below where we define the x axis as an argument in the `ggplot` function rather than in the `geom_histogram` function. This can be important to consider as you build more complicated visualizations, as the precise order can change the outcome. Think of these as layers you're adding to the larger chart, and consider what layers need to be applied at the base and which are applied overtop. 

```{r}

ggplot(vtClusters %>% filter(cluster == 321785), aes(date)) + geom_histogram(binwidth=365)

```

### Histograms for Exploratory Analysis

For me beginning to plot clusters as histograms clued me to the cycles of attention that particular "viral" stories enjoyed during their lives in nineteenth-century newspapers. I had seen this or that text being reprinted, disappearing for awhile, and then being reprinted again, but I had not considered that such waxing and waning might be a more widespread pattern: a feature of newspaper reprinting that could be modeled more generally. 

Test out the few other clusters in our sample data. Do their histograms bear out such a cicular model of nineteenth-century reprinting or not? Is 365 the best bin width for visualizing all of the clusters in this dataset? Why or why not? Hint: the function `unique` can identify all the distinct values in a particular column.

```{r}

ggplot(vtClusters %>% filter(cluster == 321785)) + geom_histogram(aes(x=date), binwidth=365)

```

Thus far we've been using `filter` from dplyr to look at one cluster at a time, but we could also create a histogram that layers multiple clusters over each other. The code below doesn't quite work for that purpose. Any theories as to why not?

```{r}

ggplot(vtClusters, aes(date, fill = cluster)) + geom_histogram(binwidth=365)


```


Perhaps that's too many to really compare meaningfully. Does it work better with two? Which two? Again, how does adjusting the bins change things?

```{r}

ggplot(vtClusters %>% filter(cluster == 321785 | cluster == 355594), aes(date, fill = as.character(cluster))) + geom_histogram(binwidth=365)

```

## Barplot (fitz, how different form histograms)


## Scatterplot

```{r}

ggplot(census) +
  geom_point(mapping = aes(x = Periodicals, y = LiterateWhiteAge20andOver))

```

```{r}
ggplot(census) + 
  geom_point(mapping = aes(x = Periodicals, y = LiterateWhiteAge20andOver)) +
  geom_smooth(mapping = aes(x = Periodicals, y = LiterateWhiteAge20andOver))
```



other stuff to include:

how scale changes what visualizations show/mean

changing axes 

aesthetics: changing labels, sizes, etc. (fitz)

facets/small multiples?


# Exercises

I am making some changes down here at the bottom just to see what happens. Here is a code block:

```{r}

print("Hello world.")

```

